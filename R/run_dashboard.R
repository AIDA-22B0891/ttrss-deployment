#' –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞
#'
#' –ò—â–µ—Ç —Ñ–∞–π–ª dashboard.qmd –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ Quarto.
#' –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç .env –∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
#' @export
run_dashboard <- function() {
  # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  if (!requireNamespace("quarto", quietly = TRUE)) {
    stop("–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç: install.packages('quarto')")
  }

  # 2. –ê–≤—Ç–æ-–∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
  # –≠—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç —Ç–≤–æ—é –æ—à–∏–±–∫—É "Missing required env var"
  if (file.exists(".env")) {
    readRenviron(".env")
    message("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env –∑–∞–≥—Ä—É–∂–µ–Ω—ã.")
  } else {
    warning("‚ö†Ô∏è –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ! –î–∞—à–±–æ—Ä–¥ –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ.")
  }

  # 3. –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞ –¥–∞—à–±–æ—Ä–¥–∞ –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞
  dash_path <- system.file("dashboard", "dashboard.qmd", package = "NewsHarvestR")
  
  # –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–∫–µ—Ç–µ, –∏—â–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
  if (dash_path == "") {
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
    local_dash_path <- "inst/dashboard/dashboard.qmd"
    if (file.exists(local_dash_path)) {
      dash_path <- local_dash_path
      message("‚úÖ –ù–∞–π–¥–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–∞—à–±–æ—Ä–¥–∞: ", local_dash_path)
    } else {
      # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ inst/, –ø—Ä–æ–≤–µ—Ä–∏–º –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
      local_dash_path <- "dashboard.qmd"
      if (file.exists(local_dash_path)) {
        dash_path <- local_dash_path
        message("‚úÖ –ù–∞–π–¥–µ–Ω —Ñ–∞–π–ª –¥–∞—à–±–æ—Ä–¥–∞ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞: ", local_dash_path)
      } else {
        stop("–§–∞–π–ª dashboard.qmd –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ inst/dashboard/ –∏–ª–∏ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.")
      }
    }
  }
  
  if (dash_path == "") {
    stop("–§–∞–π–ª dashboard.qmd –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç.")
  }

  message("üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∞—à–±–æ—Ä–¥ –∏–∑: ", dash_path)
  
  # 4. –ó–∞–ø—É—Å–∫
  # –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∞—à–±–æ—Ä–¥, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —ç—Ç–æ —Ñ–∞–π–ª –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π
  quarto::quarto_preview(file = dash_path)
}